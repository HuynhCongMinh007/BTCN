<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="AppPaint.Views.DrawingCanvasPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:AppPaint.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

  <Grid>
        <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

  <!-- Toolbar -->
 <Border Grid.Row="0" 
    Background="{ThemeResource LayerFillColorDefaultBrush}"
   BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
      BorderThickness="0,0,0,1">
   <Grid>
      <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
</Grid.RowDefinitions>

            <!-- Top Row: Main Groups -->
            <Grid Grid.Row="0" Padding="12,8,12,4">
         <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
                 <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

      <!-- Left: Toggle Toolbar Button -->
       <Button x:Name="ToggleToolbarButton"
           Style="{StaticResource IconButtonStyle}"
       Click="ToggleToolbarButton_Click"
     ToolTipService.ToolTip="Show/Hide Toolbar">
               <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
 Glyph="&#xE700;"/>
             </Button>

       <!-- Center: Group Labels -->
              <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="24" HorizontalAlignment="Left" Margin="16,0,0,0">
 <TextBlock Text="Tools" FontWeight="SemiBold" VerticalAlignment="Center"/>
         <TextBlock Text="Brushes" FontWeight="SemiBold" VerticalAlignment="Center"/>
    <TextBlock Text="Canvas" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>

           <!-- Right: Actions -->
        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
    <Button x:Name="ClearButton" 
        Style="{StaticResource IconButtonStyle}" 
           Command="{x:Bind ViewModel.ClearCanvasCommand}"
            ToolTipService.ToolTip="Clear Canvas">
        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE894;"/>
             </Button>
     
        <Button x:Name="SaveButton" 
         Style="{StaticResource AppAccentButtonStyle}"
            Command="{x:Bind ViewModel.SaveAsTemplateCommand}"
                 ToolTipService.ToolTip="Save as Template">
            <StackPanel Orientation="Horizontal" Spacing="8">
        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE74E;"/>
           <TextBlock Text="Save"/>
       </StackPanel>
         </Button>
   </StackPanel>
            </Grid>

   <!-- Bottom Row: Collapsible Toolbar Content -->
          <Grid x:Name="ToolbarContent" Grid.Row="1" Padding="12,4,12,12">
    <Grid.ColumnDefinitions>
<ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="Auto"/>
      <ColumnDefinition Width="Auto"/>
       <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

 <!-- Group 1: Tools (Shapes) -->
     <Border Grid.Column="0" 
  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
         BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
  BorderThickness="1"
  CornerRadius="4"
        Padding="12"
             Margin="0,0,8,0">
            <StackPanel Spacing="8">
        <TextBlock Text="Shapes" FontSize="12" Opacity="0.7"/>
     <StackPanel Orientation="Horizontal" Spacing="4">
            <ToggleButton x:Name="LineButton" 
      Width="36" Height="36" 
     ToolTipService.ToolTip="Line"
          Click="ShapeButton_Click"
   Tag="Line">
    <Viewbox Width="18" Height="18">
              <Canvas Width="24" Height="24">
       <Line X1="4" Y1="20" X2="20" Y2="4" 
           Stroke="{ThemeResource TextFillColorPrimaryBrush}" 
            StrokeThickness="2"/>
       </Canvas>
          </Viewbox>
           </ToggleButton>
            
      <ToggleButton x:Name="RectangleButton" 
           Width="36" Height="36" 
     ToolTipService.ToolTip="Rectangle"
      Click="ShapeButton_Click"
    Tag="Rectangle">
       <Viewbox Width="18" Height="18">
                <Canvas Width="24" Height="24">
  <Rectangle Width="16" Height="12" 
     Canvas.Left="4" Canvas.Top="6"
          Stroke="{ThemeResource TextFillColorPrimaryBrush}" 
     StrokeThickness="2"/>
       </Canvas>
               </Viewbox>
           </ToggleButton>
           
          <ToggleButton x:Name="OvalButton" 
         Width="36" Height="36" 
            ToolTipService.ToolTip="Oval"
     Click="ShapeButton_Click"
  Tag="Oval">
   <Viewbox Width="18" Height="18">
      <Canvas Width="24" Height="24">
    <Ellipse Width="16" Height="10" 
     Canvas.Left="4" Canvas.Top="7"
    Stroke="{ThemeResource TextFillColorPrimaryBrush}" 
       StrokeThickness="2"/>
        </Canvas>
       </Viewbox>
      </ToggleButton>
             
    <ToggleButton x:Name="CircleButton" 
            Width="36" Height="36" 
  ToolTipService.ToolTip="Circle"
      Click="ShapeButton_Click"
        Tag="Circle">
             <Viewbox Width="18" Height="18">
     <Canvas Width="24" Height="24">
<Ellipse Width="14" Height="14" 
          Canvas.Left="5" Canvas.Top="5"
        Stroke="{ThemeResource TextFillColorPrimaryBrush}" 
    StrokeThickness="2"/>
              </Canvas>
          </Viewbox>
     </ToggleButton>
         
       <ToggleButton x:Name="TriangleButton" 
    Width="36" Height="36" 
       ToolTipService.ToolTip="Triangle"
       Click="ShapeButton_Click"
   Tag="Triangle">
    <Viewbox Width="18" Height="18">
      <Canvas Width="24" Height="24">
            <Polygon Points="12,4 4,20 20,20"
        Stroke="{ThemeResource TextFillColorPrimaryBrush}" 
  StrokeThickness="2"/>
          </Canvas>
  </Viewbox>
       </ToggleButton>
           
         <ToggleButton x:Name="PolygonButton" 
         Width="36" Height="36" 
  ToolTipService.ToolTip="Polygon"
      Click="ShapeButton_Click"
        Tag="Polygon">
           <Viewbox Width="18" Height="18">
   <Canvas Width="24" Height="24">
     <Polygon Points="12,3 20,8 18,18 6,18 4,8"
     Stroke="{ThemeResource TextFillColorPrimaryBrush}" 
     StrokeThickness="2"/>
  </Canvas>
        </Viewbox>
    </ToggleButton>
          </StackPanel>
   </StackPanel>
     </Border>

          <!-- Group 2: Brushes (Color, Thickness, Style) -->
         <Border Grid.Column="1" 
     Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
          BorderThickness="1"
      CornerRadius="4"
      Padding="12"
              Margin="0,0,8,0">
         <StackPanel Spacing="8">
      <TextBlock Text="Brushes" FontSize="12" Opacity="0.7"/>
              <Grid>
  <Grid.ColumnDefinitions>
    <ColumnDefinition Width="Auto"/>
   <ColumnDefinition Width="Auto"/>
       <ColumnDefinition Width="Auto"/>
                 </Grid.ColumnDefinitions>
                
            <!-- Color -->
               <StackPanel Grid.Column="0" Spacing="4" Margin="0,0,12,0">
      <TextBlock Text="Color" FontSize="11" Opacity="0.6"/>
  <ColorPicker x:Name="StrokeColorPicker" 
      ColorSpectrumShape="Ring"
    IsColorSliderVisible="False"
           IsColorChannelTextInputVisible="False"
          IsHexInputVisible="False"
       IsAlphaEnabled="False"
              ColorChanged="StrokeColorPicker_ColorChanged"
         Width="36" Height="36"/>
             </StackPanel>
           
 <!-- Thickness -->
     <StackPanel Grid.Column="1" Spacing="4" Margin="0,0,12,0">
         <TextBlock Text="Size" FontSize="11" Opacity="0.6"/>
          <StackPanel Orientation="Horizontal" Spacing="4">
     <Slider x:Name="StrokeThicknessSlider" 
               Minimum="1" Maximum="20" 
       Value="{x:Bind ViewModel.StrokeThickness, Mode=TwoWay}"
     Width="100" VerticalAlignment="Center"/>
   <TextBlock Text="{x:Bind StrokeThicknessSlider.Value, Mode=OneWay}" 
    VerticalAlignment="Center" Width="24"/>
     </StackPanel>
      </StackPanel>
           
        <!-- Style & Fill -->
         <StackPanel Grid.Column="2" Spacing="4">
    <TextBlock Text="Options" FontSize="11" Opacity="0.6"/>
       <StackPanel Spacing="4">
    <ComboBox x:Name="StrokeStyleComboBox"
 SelectedIndex="0"
             SelectionChanged="StrokeStyleComboBox_SelectionChanged"
      MinWidth="100">
  <ComboBoxItem Content="Solid" Tag="Solid"/>
     <ComboBoxItem Content="Dash" Tag="Dash"/>
  <ComboBoxItem Content="Dot" Tag="Dot"/>
     <ComboBoxItem Content="Dash-Dot" Tag="DashDot"/>
    </ComboBox>
        
     <!-- Fill Option with Color Picker -->
         <Grid>
         <Grid.ColumnDefinitions>
    <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="Auto"/>
       </Grid.ColumnDefinitions>
 
        <CheckBox x:Name="FillCheckBox" 
  Grid.Column="0"
  Content="Fill" 
   FontSize="11"
         VerticalAlignment="Center"
    IsChecked="{x:Bind ViewModel.IsFilled, Mode=TwoWay}"/>
            
     <!-- Fill Color Picker (visible when Fill is checked) -->
       <ColorPicker x:Name="FillColorPicker"
               Grid.Column="1"
            Margin="4,0,0,0"
    ColorSpectrumShape="Ring"
    IsColorSliderVisible="False"
    IsColorChannelTextInputVisible="False"
    IsHexInputVisible="False"
 IsAlphaEnabled="False"
         ColorChanged="FillColorPicker_ColorChanged"
            Width="24" 
     Height="24"
              Visibility="{x:Bind FillCheckBox.IsChecked, Mode=OneWay}"/>
      </Grid>
       </StackPanel>
       </StackPanel>
  </Grid>
   </StackPanel>
     </Border>

                <!-- Group 3: Canvas Settings -->
          <Border Grid.Column="2" 
    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
         BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
         BorderThickness="1"
            CornerRadius="4"
         Padding="12"
           Margin="0,0,8,0">
      <StackPanel Spacing="8">
        <TextBlock Text="Canvas" FontSize="12" Opacity="0.7"/>
  <Grid>
     <Grid.ColumnDefinitions>
         <ColumnDefinition Width="Auto"/>
     <ColumnDefinition Width="Auto"/>
           </Grid.ColumnDefinitions>
      
          <!-- Size -->
         <StackPanel Grid.Column="0" Spacing="4" Margin="0,0,12,0">
           <TextBlock Text="Size" FontSize="11" Opacity="0.6"/>
          <ComboBox x:Name="CanvasSizeComboBox"
           SelectionChanged="CanvasSizeComboBox_SelectionChanged"
       SelectedIndex="2"
    MinWidth="110">
           <ComboBoxItem Content="640x480" Tag="640x480"/>
       <ComboBoxItem Content="800x600" Tag="800x600"/>
  <ComboBoxItem Content="1024x768" Tag="1024x768"/>
        <ComboBoxItem Content="1280x720" Tag="1280x720"/>
  <ComboBoxItem Content="1920x1080" Tag="1920x1080"/>
            </ComboBox>
</StackPanel>
      
         <!-- Background -->
   <StackPanel Grid.Column="1" Spacing="4">
            <TextBlock Text="Background" FontSize="11" Opacity="0.6"/>
              <Button x:Name="BackgroundColorButton"
   Width="36" Height="36">
       <Button.Content>
         <Border Width="24" Height="24"
          CornerRadius="2"
   BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
         BorderThickness="1">
    <Border.Background>
            <SolidColorBrush x:Name="BackgroundColorPreview" Color="White"/>
     </Border.Background>
        </Border>
        </Button.Content>
      <Button.Flyout>
        <Flyout Placement="Bottom">
        <StackPanel Spacing="12" Padding="8">
           <TextBlock Text="Canvas Background" FontWeight="SemiBold"/>
             <ColorPicker x:Name="BackgroundColorPicker"
  ColorSpectrumShape="Ring"
     IsColorSliderVisible="True"
            IsColorChannelTextInputVisible="False"
        IsHexInputVisible="False"
     IsAlphaEnabled="False"
     ColorChanged="BackgroundColorPicker_ColorChanged"/>
       </StackPanel>
              </Flyout>
                </Button.Flyout>
  </Button>
      </StackPanel>
            </Grid>
          </StackPanel>
           </Border>

            <!-- Polygon Finish Button (when needed) -->
       <StackPanel Grid.Column="3" VerticalAlignment="Center" Margin="12,0,0,0">
          <Button x:Name="FinishPolygonButton"
         Style="{StaticResource AppAccentButtonStyle}"
            Click="FinishPolygonButton_Click"
   Visibility="Collapsed">
             <StackPanel Orientation="Horizontal" Spacing="8">
<FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE73E;"/>
       <TextBlock Text="Finish Polygon"/>
               </StackPanel>
           </Button>
        </StackPanel>
   </Grid>
        </Grid>
  </Border>

        <!-- Canvas Area -->
  <ScrollViewer Grid.Row="1" 
     HorizontalScrollBarVisibility="Auto"
       VerticalScrollBarVisibility="Auto"
    Padding="24">
   <Border Style="{StaticResource AppCardStyle}"
      HorizontalAlignment="Left"
   VerticalAlignment="Top">
       <Grid>
  <!-- Canvas Background with Fixed Size -->
  <Border x:Name="CanvasBackground" 
  CornerRadius="4"
      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
     BorderThickness="1"
    Width="{x:Bind ViewModel.CanvasWidth, Mode=OneWay}"
       Height="{x:Bind ViewModel.CanvasHeight, Mode=OneWay}">
            <Border.Background>
    <SolidColorBrush x:Name="CanvasBackgroundBrush" Color="White"/>
       </Border.Background>

        <!-- Drawing Canvas - Fixed Size -->
      <Canvas x:Name="DrawingCanvas" 
     Background="Transparent"
           Width="{x:Bind ViewModel.CanvasWidth, Mode=OneWay}"
Height="{x:Bind ViewModel.CanvasHeight, Mode=OneWay}"/>
      </Border>

     <!-- Empty State -->
  <StackPanel x:Name="EmptyState" 
     Style="{StaticResource EmptyStateStyle}"
   Visibility="Collapsed">
   <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
     Glyph="&#xE70F;" 
 FontSize="64"
      Opacity="0.3"/>
  <TextBlock Text="Select a tool and start drawing" 
      Style="{StaticResource SubtitleTextBlockStyle}"
        Opacity="0.6"/>
           <TextBlock Text="Choose a shape from the toolbar above" 
        Opacity="0.5"/>
   </StackPanel>
        </Grid>
   </Border>
    </ScrollViewer>
  </Grid>
</Page>
